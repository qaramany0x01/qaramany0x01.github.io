---
title: "أساسيات الاندرويد"
date: "2024-9-12"
layout: single
---




# مقدمة في اختراق تطبيقات الأندرويد - الجزء الاول 

 <div dir="auto">

بسم الله نبدأ! في السلسلة دي هنتكلم عن اساسيات اختراق تطبيقات الأندرويد، وإزاي نستغل الثغرات اللي ممكن نلاقيها في التطبيقات. هنطبق الكلام ده عملي على كذا سيناريو عشان نفهم الدنيا كويس، بس الأول لازم نعرف شوية معلومات أساسية عن **Android Architecture ** هناخد مثلاً، مقدمة نظرية عن الأندرويد أركيتكتشر، وإزاي النظام دا بيشتغل عشان نبقى فاهمين إيه اللي بيحصل لما بننزل أي APK بالتفصيل
 </div>

---

## مقدمة عن هيكلية الأندرويد - Android Architecture 

 <div dir="auto">
الفكرة كلها إن الأندرويد مبني على نظام لينكس، واللينكس شبيه بأي نظام تشغيل تاني، بيحتوي على مستخدمين. يعني زي الويندوز، ممكن يكون عندك يوسف وكريم، أو حتى يكون عندك حساب تاني له صلاحيات الأدمين. في اللينكس، نفس الشيء، عندك يوسف وكريم، وكمان روت اللي هو الحساب اللي معاه كل الصلاحيات.
<br><br>
لما بتنزل ملف APK على جهاز الأندرويد، النظام بيفكر فيه كأنه مستخدم جديد. يعني كل تطبيق زي البلاي ستور أو جوجل كروم، يعتبر كأنه شخص جديد على الجهاز. كل واحد فيهم بيكون له **يوزر ID** مختلف، يعنى بيتعامل مع النظام وكأنه مستخدم مستقل. حتى لو النظام الأساسي نفسه واحد، كل تطبيق بيكون له حساب مستخدم مستقل. ده بيخلينا نفكر في الأندرويد وكأنه بيدير كل تطبيق وكأنه مستخدم جديد، عشان يحافظ على الأمان ويقدر يتحكم في الصلاحيات بشكل منفصل لكل واحد فيهم.
<br><br>
الفكرة هي إن كل يوزر على جهاز الأندرويد ليه فولدراته الخاصة بيخزن فيها البيانات بتاعته. يعني كل يوزر مستقل عن التاني. لما بتنزل ملف APK مثلاً زي البلاي ستور أو كروم، كل واحد فيهم بيكون ليه فولدر خاص بيه على الجهاز يخزن فيه بياناته. ده بيساعد في عزل التطبيقات عن بعضها، ما بينفعش تطبيق فيسبوك يدخل ويشوف البيانات اللي تطبيق كروم مخزنها أو العكس. كل تطبيق محسوب كيوزر مختلف وله فولدراته المعزولة الخاصة، مش بيفوت على بعضها.
<br><br>
أما بالنسبة للـ **يوزر ID**، ده اللي بيكون مسؤول عن تشغيل البرنامج. يعني لما بتشغل أي برنامج، البرنامج ده (أو الـAPK) بيشتغل تحت اليوزر ده. زي لما تفتح برنامج معين على الكمبيوتر، كل برنامج يشتغل بشكل منفصل عن التاني. وبالتالي، كل تطبيق بيكون معزول عن التاني. كروم مش هيشوف بيانات فيسبوك وهكذا،  كل برنامج بيشتغل بمعزل عن التاني
<br><br>
دلوقتي موضوع الـ  **sandboxing** ممكن تحسه مرتبط شوية بال **virtualization**
بس هما مش نفس الشئ
<br><br>
 **Sandboxing**: 
 <br>
 هو تقنية العزل التي توفر بيئة معزولة لكل تطبيق على جهاز الأندرويد أو نظام التشغيل لينكس بشكل عام. يهدف إلى منع التطبيقات من الوصول إلى بيانات التطبيقات الأخرى أو التأثير عليها. يشبه وضع كل تطبيق في صندوق خاص به، بحيث لا يستطيع تجاوز حدوده أو التأثير على التطبيقات الأخرى. حتى لو كان هناك خطأ في تطبيق ما، فهو لا يستطيع التأثير على النظام ككل أو التطبيقات الأخرى.
 
<br><br>

 **Virtualization**: 
 <br>
 يشير إلى تشغيل بيئات متعددة أو أنظمة تشغيل داخل نظام تشغيل واحد. في سياق الأندرويد، قد يتم تشغيل تطبيق داخل جهاز افتراضي بحيث يكون له نظام تشغيل صغير خاص به، ومعزول عن النظام الرئيسي. الـ **virtualization** يسمح بتشغيل عدة أنظمة أو تطبيقات بشكل مستقل، لكنه عادة ما يكون أكثر تعقيداً من الـ **sandboxing**.
 
 <br><br>

بمعنى آخر، الـ **sandboxing** هو مجرد جزء من الـ **virtualization**
<br>
الـ **sandboxing** يركز على عزل التطبيقات، بينما الـ **virtualization** يمكن أن يشمل عزل الأنظمة بأكملها وتشغيلها بشكل مستقل داخل نظام التشغيل الرئيسي.

 <br><br>
  </div>

  <div dir="auto">

<br>

<p>
    الموضوع ببساطة إن الأندرويد مبني على نظام لينكس، واللينكس شبيه بأي نظام تشغيل تاني، بيحتوي على مستخدمين. يعني زي الويندوز، ممكن يكون عندك يوسف وكريم، أو حتى يكون عندك حساب تاني له صلاحيات الأدمين. في اللينكس، نفس الشيء، عندك يوسف وكريم، وكمان روت اللي هو الحساب اللي معاه كل الصلاحيات.
</p>

<p>
    لما بتنزل ملف APK على جهاز الأندرويد، النظام بيفكر فيه كأنه مستخدم جديد. يعني كل تطبيق زي البلاي ستور أو جوجل كروم، يعتبر كأنه شخص جديد على الجهاز. كل واحد فيهم بيكون له **يوزر ID** مختلف، يعنى بيتعامل مع النظام وكأنه مستخدم مستقل. حتى لو النظام الأساسي نفسه واحد، كل تطبيق بيكون له حساب مستخدم مستقل. ده بيخلينا نفكر في الأندرويد وكأنه بيدير كل تطبيق وكأنه مستخدم جديد، عشان يحافظ على الأمان ويقدر يتحكم في الصلاحيات بشكل منفصل لكل واحد فيهم.
</p>

<p>
    الفكرة هي إن كل يوزر على جهاز الأندرويد ليه فولدراته الخاصة بيخزن فيها البيانات بتاعته. يعني كل يوزر مستقل عن التاني. لما بتنزل ملف APK مثلاً زي البلاي ستور أو كروم، كل واحد فيهم بيكون ليه فولدر خاص بيه على الجهاز يخزن فيه بياناته. ده بيساعد في عزل التطبيقات عن بعضها، ما بينفعش تطبيق فيسبوك يدخل ويشوف البيانات اللي تطبيق كروم مخزنها أو العكس. كل تطبيق محسوب كيوزر مختلف وله فولدراته المعزولة الخاصة، مش بيفوت على بعضها.
</p>

<p>
    أما بالنسبة للـ **يوزر ID**، ده اللي بيكون مسؤول عن تشغيل البرنامج. يعني لما بتشغل أي برنامج، البرنامج ده (أو الـAPK) بيشتغل تحت اليوزر ده. زي لما تفتح برنامج معين على الكمبيوتر، كل برنامج يشتغل بشكل منفصل عن التاني. وبالتالي، كل تطبيق بيكون معزول عن التاني. كروم مش هيشوف بيانات فيسبوك وهكذا، كل برنامج بيشتغل بمعزل عن التاني.
</p>

<p>
    ليه بقى؟ لأن نظام الأندرويد بيستخدم حاجة اسمها **Isolation**، وبيعمل عزل لكل تطبيق عن التاني.
</p>

<p>
    هنا بقى يجي سؤال مهم: لو كل تطبيق بيرن معزول، إزاي يقدروا يتكلموا مع بعض؟ الإجابة: ما يقدروش يتواصلوا بشكل مباشر إلا في حالة واحدة، وهي باستخدام حاجة اسمها **IPC** (Inter-Process Communication). يعني مثلاً لو فيسبوك محتاج يتواصل مع كروم لأي سبب (زي مشاركة بيانات أو تسويق)، بيتم ده باستخدام الـIPC. وهنشوف في الكورس ده إيه هي الآليات اللي بتحافظ على العزل ده وإزاي التطبيقات بتتكلم مع بعض بشكل آمن.
</p>

<p>
    برنامجين يكونوا زي بعض بالظبط، يعني يشتغلوا تحت نفس اليوزر. هل ينفع أعمل كده؟ أيوة ينفع، مثلاً لو اديت برنامجين نفس اليوزر ID، هيبقى ليهم نفس الفولدر وهيبقى شايفين نفس البروسيس، يعني شايفين بعض بشكل كامل. ده ينفع لو عملت حاجة اسمها **UID Sharing**، يعني أديت للبرنامجين نفس الـUID. في الحالة دي، البرنامجين هيبقوا نفس اليوزر على السيستم، وكل بروسيس تبقى شايفة التانية لأنهم نفس اليوزر.
</p>

<p>
    لكن ده بيتحدد إزاي؟ بيتحدد وانت بتبني الـAPK، بتحط إنك عايز الـUID الخاص بيك يتشارك مع برنامج تاني. طبعاً، لو برنامج واحد بيعمل حاجة كـPrivileged Program، التاني هيشارك معاه في الحاجات دي. الميزة دي مش مستخدمة كتير، لكنها موجودة في حالات خاصة.
</p>

<p>
    ننتقل لموضوع تاني وهو **Android Stack**. الأندرويد ستاك معمول إزاي؟ عندنا أول حاجة **Linux Kernel**، اللي هو الكيرنل الطبيعي الموجود في أي Operating System. الكيرنل ده هو المسؤول عن التعامل مع الـHardware مباشرةً. مثلاً: Audio Drivers، Camera Drivers، WiFi Drivers... الكيرنل ده شغال في **Ring 0**، يعني مرتبط بشكل مباشر مع الهاردوير.
</p>

<p>
    فوق الكيرنل بقى فيه **Libraries**. دي عبارة عن مكاتب برمجية بتخليني أقدر أتفاعل مع الكيرنل. ممكن أستخدمها مثلاً في حاجات زي SSL، أو مكتبات الشبكات، وهكذا.
</p>

<p>
    بعد كده فيه حاجة اسمها **Android Runtime**. الأندرويد رانتايم ده هو المسؤول عن تشغيل التطبيقات داخل الـSandbox. يعني لما بنشغل أي برنامج، الكود بتاعه بيشتغل جوا الأندرويد رانتايم. في الأندرويد، التطبيقات بتكون في شكل ملفات اسمها **DEX Files**. الـDEX ده هو اختصار لـDalvik Executable، وده ما يقابل مثلاً الـEXE في الويندوز أو ELF في اللينكس. الـDEX هو اللي بيتم تشغيله في الأندرويد رانتايم.
</p>

<p>
    طب ده بيشتغل فين؟ بيشتغل جوا الأندرويد رانتايم، اللي هو فيه الـVirtual Machine الخاصة بالأندرويد، زي Dalvik أو ART (Android Runtime).
</p>

</div>

  
